<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - مخصص لطلاب علوم الحاسوب</title>
    <style>
        /* Same CSS from index.html */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
            direction: rtl;
        }

        header {
            background-color: #007BFF;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        header h1 {
            margin-bottom: 0.5rem;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .section {
            background-color: white;
            border-radius: 5px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .section h2 {
            margin-bottom: 0.5rem;
        }

        .file-list {
            list-style-type: none;
        }

        .file-item-dashboard {
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item-dashboard:last-child {
            border-bottom: none;
        }

        .file-info {
            flex-grow: 1;
        }

        .file-actions button {
            margin-left: 0.5rem;
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .btn-upload {
            background-color: #17a2b8;
            color: white;
        }

        .btn-delete {
            background-color: #dc3545;
            color: white;
        }

        .btn-change-password {
            background-color: #ffc107;
            color: #212529;
            margin-top: 0.5rem;
        }

        input[type="file"] {
            margin-top: 0.5rem;
        }

        #changePasswordForm {
            display: none; /* Initially hidden */
        }

        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            main {
                padding: 0 0.5rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>لوحة التحكم</h1>
        <p>مرحبًا بعودتك، Abdulhamid</p>
    </header>

    <main>
        <div class="section">
            <h2>تغيير كلمة المرور</h2>
            <form id="changePasswordForm">
                <label for="currentPassword">كلمة المرور الحالية:</label><br>
                <input type="password" id="currentPassword" required><br>
                <label for="newPassword">كلمة المرور الجديدة:</label><br>
                <input type="password" id="newPassword" required><br>
                <button type="submit" class="btn-change-password">تغيير كلمة المرور</button>
            </form>
            <button id="showChangePasswordBtn" class="btn-change-password">تغيير كلمة المرور</button>
        </div>

        <div class="section">
            <h2>رفع ملف</h2>
            <input type="file" id="fileInput" multiple>
            <button id="uploadButton" class="btn-upload">رفع الملفات</button>
            <p id="uploadStatus"></p>
        </div>

        <div class="section">
            <h2>ملفاتك</h2>
            <ul id="fileList" class="file-list">
                <!-- سيتم ملء هذه القائمة من خلال JavaScript -->
            </ul>
        </div>

        <div class="section">
            <button id="logoutButton">تسجيل الخروج</button>
        </div>
    </main>

    <footer>
        <p>من إعداد Abdulhamid – مخصص لطلاب علوم الحاسوب</p>
    </footer>

    <script>
        // --- إعدادات ---
        let storedPassword = localStorage.getItem('masterPassword');
        if (!storedPassword) {
             storedPassword = "defaultPassword123";
             localStorage.setItem('masterPassword', storedPassword);
        }

        let files = JSON.parse(localStorage.getItem('sharedFiles')) || [];

        // --- عناصر DOM ---
        const fileInput = document.getElementById('fileInput');
        const uploadButton = document.getElementById('uploadButton');
        const fileList = document.getElementById('fileList');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const showChangePasswordBtn = document.getElementById('showChangePasswordBtn');
        const changePasswordFormElement = document.getElementById('changePasswordForm');
        const currentPasswordInput = document.getElementById('currentPassword');
        const newPasswordInput = document.getElementById('newPassword');
        const logoutButton = document.getElementById('logoutButton');
        const uploadStatus = document.getElementById('uploadStatus');

        // --- عرض قائمة الملفات ---
        function renderFileList() {
            fileList.innerHTML = ''; // مسح القائمة الحالية
            if (files.length === 0) {
                const emptyItem = document.createElement('li');
                emptyItem.textContent = 'لا توجد ملفات.';
                fileList.appendChild(emptyItem);
                return;
            }

            files.forEach((file, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'file-item-dashboard';

                const icon = file.type === 'pdf' ? '📄' : file.type === 'video' ? '🎥' : file.type === 'zip' ? '📦' : '🖼️';
                listItem.innerHTML = `
                    <div class="file-info">
                        ${icon} ${file.name}
                    </div>
                    <div class="file-actions">
                        <a href="#" onclick="downloadFile(${index})"><button>تنزيل</button></a>
                        <button onclick="deleteFile(${index})">حذف</button>
                    </div>
                `;
                fileList.appendChild(listItem);
            });
        }

        // --- رفع الملفات ---
        uploadButton.addEventListener('click', () => {
            const filesToUpload = Array.from(fileInput.files);
            if (filesToUpload.length === 0) {
                uploadStatus.textContent = 'يرجى اختيار ملفات أولاً.';
                return;
            }

            // نقوم ببساطة إضافة الملفات إلى القائمة (في تطبيق حقيقي، يجب رفعها إلى خادم)
            filesToUpload.forEach(file => {
                // هنا نقوم بإنشاء كائن ملف بسيط
                // في تطبيق حقيقي، يجب تحميل الملف إلى خادم وحفظ مساره
                const newFile = {
                    name: file.name,
                    type: file.type.split('/')[1] || 'unknown', // الحصول على نوع الملف (pdf, mp4, ...)
                    size: file.size,
                    // في تطبيق حقيقي، سيكون هناك مسار أو رابط للملف
                    url: URL.createObjectURL(file) // هذا فقط لعرضه في المتصفح (غير مناسب للتخزين الفعلي)
                };
                files.push(newFile);
            });

            localStorage.setItem('sharedFiles', JSON.stringify(files)); // حفظ في localStorage
            renderFileList(); // تحديث القائمة
            fileInput.value = ''; // مسح الملفات المختارة
            uploadStatus.textContent = `تم رفع ${filesToUpload.length} ملف(ات).`;
        });

        // --- حذف ملف ---
        function deleteFile(index) {
            if (confirm(`هل أنت متأكد من حذف "${files[index].name}"؟`)) {
                files.splice(index, 1); // حذف الملف من المصفوفة
                localStorage.setItem('sharedFiles', JSON.stringify(files)); // حفظ التغييرات
                renderFileList(); // تحديث القائمة
            }
        }

        // --- تنزيل ملف ---
        function downloadFile(index) {
            // في هذا المثال، نستخدم URL.createObjectURL الذي تم إنشاؤه عند الرفع
            // لكن في تطبيق حقيقي، يجب أن يكون هناك رابط مباشر للملف
            const fileUrl = files[index].url;
            if (fileUrl) {
                const link = document.createElement('a');
                link.href = fileUrl;
                link.download = files[index].name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert("لا يمكن تنزيل هذا الملف في هذا الوقت.");
            }
        }

        // --- تغيير كلمة المرور ---
        showChangePasswordBtn.addEventListener('click', () => {
            changePasswordForm.style.display = 'block';
            showChangePasswordBtn.style.display = 'none';
        });

        changePasswordFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const currentPassword = currentPasswordInput.value;
            const newPassword = newPasswordInput.value;

            if (currentPassword !== storedPassword) {
                alert("كلمة المرور الحالية غير صحيحة.");
                return;
            }

            if (newPassword.length < 6) {
                alert("كلمة المرور الجديدة يجب أن تكون على الأقل 6 أحرف.");
                return;
            }

            storedPassword = newPassword;
            localStorage.setItem('masterPassword', storedPassword);
            alert("تم تغيير كلمة المرور بنجاح!");
            changePasswordForm.style.display = 'none';
            showChangePasswordBtn.style.display = 'inline-block';
            currentPasswordInput.value = '';
            newPasswordInput.value = '';
        });

        // --- تسجيل الخروج ---
        logoutButton.addEventListener('click', () => {
            alert("تم تسجيل الخروج.");
            window.location.href = 'index.html'; // إعادة توجيه إلى الصفحة الرئيسية
        });

        // --- تحميل القائمة عند تحميل الصفحة ---
        document.addEventListener('DOMContentLoaded', () => {
            renderFileList();
        });
    </script>
</body>
</html>